# SqlApp2 🎉

**マルチRDBMS対応のモダンなWebベースSQLクエリツール**

[![Java](https://img.shields.io/badge/Java-21-orange.svg)](https://openjdk.org/)
[![Spring Boot](https://img.shields.io/badge/Spring%20Boot-3.5.4-green.svg)](https://spring.io/projects/spring-boot)
[![React](https://img.shields.io/badge/React-18-blue.svg)](https://reactjs.org/)
[![TypeScript](https://img.shields.io/badge/TypeScript-5-blue.svg)](https://www.typescriptlang.org/)
[![License](https://img.shields.io/badge/License-Apache%202.0-blue.svg)](LICENSE)

SqlApp2は、複数のデータベースシステムに対してSQLクエリを実行するための直感的なインターフェースを提供する、セキュアでモダンなWebアプリケーションです。Spring BootとReactで構築され、エンタープライズ級のセキュリティ、マルチデータベースサポート、レスポンシブなユーザーエクスペリエンスを提供します。

## 🚀 主要機能

### 🔐 セキュリティファースト
- **JWT認証**: ステートレスなトークンベース認証システム
- **パスワード暗号化**: データベースパスワードのAES-256-GCM暗号化
- **SQLインジェクション保護**: PreparedStatementベースのパラメータ化クエリ
- **Spring Security統合**: エンタープライズ級のセキュリティフレームワーク

### 🗄️ マルチデータベースサポート
- **MySQL** - 最適化されたドライバーによる完全サポート
- **PostgreSQL** - 完全な互換性と機能
- **MariaDB** - ネイティブ統合とパフォーマンス

### 📊 高度SQL実行エンジン
- **高度パラメータ処理**: 文字列・コメント内を無視する状態ベース解析
- **パラメータ化クエリ**: 名前付きパラメータサポート (`:param`) と自動型変換
- **リアルタイムバリデーション**: 実行前のSQL構文チェック
- **結果表示**: 豊富なカラムメタデータ付きの表形式データ表示
- **セキュリティ**: 精密なパラメータ抽出による高度SQLインジェクション防止

### 📚 クエリ管理システム
- **クエリ保存・共有**: よく使用するSQLクエリをパラメータテンプレートと共に保存
- **公開/非公開共有**: チームメンバーとクエリを共有するか、プライベートに保持
- **クエリ履歴**: パフォーマンスメトリクス付きのSQL実行の自動追跡
- **再実行**: パラメータ復元機能付きの以前のクエリのワンクリック再実行
- **パフォーマンス分析**: 実行時間追跡、成功率、使用統計

### 🎨 ビジュアルSQLクエリビルダー
- **ドラッグ&ドロップインターフェース**: 直感的なコンポーネントでSQLクエリを視覚的に構築
- **スキーマ対応選択**: データベーススキーマからのテーブルとカラムの自動提案
- **リアルタイムSQL生成**: 構築しながら生成されるSQLのライブプレビュー
- **包括的句サポート**: SELECT、FROM、WHERE、JOIN、GROUP BY、HAVING、ORDER BY、LIMIT
- **高度な関数**: 集約関数、条件演算子、エイリアス、DISTINCT
- **パラメータ統合**: シームレスなパラメータ検出と値入力

### 🎨 モダンユーザーインターフェース
- **レスポンシブデザイン**: CSS Grid/Flexboxを使用したモバイルファーストアプローチ
- **React + TypeScript**: 型安全なコンポーネントアーキテクチャ
- **リアルタイム更新**: 動的パラメータ検出とフォーム生成
- **接続管理**: 視覚的なデータベース接続テストと管理

### 🌐 国際化（i18n）
- **多言語サポート**: 完全な英語・日本語インターフェース
- **リアルタイム言語切り替え**: リロードなしのシームレスな言語変更
- **ブラウザ言語検出**: 初回訪問時の自動言語検出
- **永続的設定**: localStorageに保存される言語選択
- **完全翻訳カバレッジ**: 全コンポーネントにわたる590+翻訳キー

### 🐳 デプロイ対応
- **単一WARデプロイ**: 統合されたフロントエンドとバックエンド
- **Dockerサポート**: Docker Composeによるコンテナ化デプロイ
- **環境設定**: Twelve-Factor Appコンプライアンス
- **H2内部データベース**: ゼロ設定開発セットアップ

## 🛠️ 技術スタック

### バックエンド
- **Java 21** - モダンな言語機能を持つ最新LTSバージョン
- **Spring Boot 3.5.4** - 本番対応フレームワーク
- **Spring Security** - 認証と認可
- **Spring Data JPA** - データベース抽象化層
- **H2 Database** - 内部データストレージ
- **Gradle 9.0.0** - ビルド自動化

### フロントエンド
- **React 18** - モダンなコンポーネントベースUIライブラリ
- **TypeScript** - 型安全なJavaScript開発
- **Vite 7.1.1** - 高速開発ビルドツール
- **React Router** - クライアントサイドルーティング
- **react-i18next v15.6.1** - 国際化フレームワーク
- **CSS3** - Grid/Flexboxを使用したモダンスタイリング

### データベースドライバー
- **MySQL Connector/J** - MySQLデータベース接続
- **PostgreSQL JDBC Driver** - PostgreSQL統合
- **MariaDB Connector/J** - MariaDBサポート

## 🚀 クイックスタート

### 前提条件
- Java 21以降
- Node.js 18以降
- Docker（オプション）

### オプション1: Dockerデプロイ（推奨）

```bash
git clone https://github.com/your-username/sqlapp2.git
cd sqlapp2
docker-compose up -d
```

http://localhost:8080 でアプリケーションにアクセス

### オプション2: ローカル開発

1. **リポジトリをクローン**
   ```bash
   git clone https://github.com/your-username/sqlapp2.git
   cd sqlapp2
   ```

2. **ビルド・実行**
   ```bash
   ./gradlew build
   java -jar build/libs/sqlapp2-1.0.0.war
   ```

3. **アプリケーションアクセス**
   - ブラウザで http://localhost:8080 を開く
   - アカウント作成またはログイン
   - データベース接続を追加
   - SQLクエリ実行開始！

### オプション3: 開発モード

ホットリロード付きのアクティブ開発向け：

```bash
# ターミナル1: バックエンド開始
./gradlew bootRun

# ターミナル2: フロントエンド開始
cd frontend
npm install
npm run dev
```

- バックエンド: http://localhost:8080
- フロントエンド: http://localhost:5173（バックエンドへプロキシ）

## 📖 ユーザーガイド

### 1. ユーザー登録とログイン
1. http://localhost:8080 にアクセス
2. 「登録」をクリックして新しいアカウントを作成
3. ユーザー名、メール、パスワードを入力
4. 資格情報でログインしてJWTトークンを受信

### 2. データベース接続セットアップ
1. ダッシュボードから「接続管理」をクリック
2. 「新しい接続を追加」をクリック
3. 接続詳細を入力：
   - **接続名**: 接続のわかりやすい名前
   - **データベースタイプ**: MySQL、PostgreSQL、またはMariaDB
   - **ホスト/ポート**: データベースサーバーの場所
   - **データベース名**: 対象データベース
   - **ユーザー名/パスワード**: データベース資格情報
4. 「接続テスト」をクリックして接続性を確認
5. 将来の使用のために接続を保存

### 3. SQLクエリ実行
1. ダッシュボードから「SQL実行に進む」をクリック
2. データベース接続を選択
3. SQLクエリを入力：
   ```sql
   SELECT * FROM users WHERE age > :minAge AND status = :status
   ```
4. SqlApp2が自動的にパラメータ（`:minAge`、`:status`）を検出
5. 適切なデータタイプでパラメータ値を入力
6. 「クエリ実行」をクリックしてSQLを実行
7. インタラクティブな表形式で結果を表示

### 4. 高度な機能
- **パラメータタイプ**: string、int、long、double、boolean、date、time、datetimeをサポート
- **クエリバリデーション**: リアルタイムSQL構文チェック
- **接続テスト**: クエリ実行前にデータベース接続性を確認
- **レスポンシブデザイン**: デスクトップとモバイルデバイスでシームレスに動作

## 🎯 ロードマップ

### ✅ Phase 1-2: MVP（完了）
- [x] JWTを使用したユーザー認証
- [x] マルチデータベース接続管理
- [x] パラメータ化クエリを使用したSQL実行
- [x] スキーマ情報取得とブラウジング
- [x] モダンなReactフロントエンド
- [x] Dockerデプロイサポート

### ✅ Phase 3: 高度な機能（完了）
#### Phase 3.1: クエリ管理
- [x] パラメータテンプレート付きのSQLクエリの保存と管理
- [x] アクセス制御付きの公開/非公開クエリ共有
- [x] パフォーマンスメトリクス付きの自動実行履歴追跡
- [x] クエリ統計ダッシュボードと分析
- [x] パラメータ復元付きのワンクリッククエリ再実行
- [x] レスポンシブデザインによる完全なUI/UX実装

#### Phase 3.2: ビジュアルSQLクエリビルダー
- [x] 包括的なQueryStructureバックエンド実装
- [x] バリデーションとフォーマット機能付きのSQL生成サービス
- [x] クエリ構築と提案のためのREST APIエンドポイント
- [x] ビジュアルクエリビルダーフロントエンドインターフェース
- [x] スキーマ対応のテーブルとカラム選択
- [x] リアルタイムSQL生成とバリデーション
- [x] すべてのSQL句と高度な関数のサポート
- [x] モバイルサポート付きレスポンシブデザイン

#### Phase 3.3: UI/UX改善・問題解決
- [x] クエリ実行履歴表示問題の修正
- [x] 保存済みクエリ実行カウント追跡の強化
- [x] 履歴での視覚的クエリタイプインジケータ（保存済み vs 直接入力）
- [x] SQL実行画面の実行モード表示ラベル
- [x] 保存済みクエリ vs 履歴のインテリジェントな再実行ロジック
- [x] 実行履歴での適切な保存済みクエリID追跡
- [x] 包括的なパラメータ処理とJSON解析

#### Phase A+B: 国際化実装（完了）
- [x] **Phase A: 完全英語統一** - 全コンポーネントにわたる体系的な言語一貫性
- [x] **Phase B: 多言語i18n基盤** - 完全なreact-i18next統合
- [x] **翻訳リソース** - 英語・日本語向け590+翻訳キー
- [x] **コンポーネント統合** - 完全なi18nサポートを持つ全8主要コンポーネント
- [x] **言語切り替え機能** - リアルタイム言語切り替えUIコンポーネント
- [x] **ブラウザ検出** - localStorage永続化付き自動言語検出
- [x] **ユーザーエクスペリエンス** - シームレスな英語⇔日本語言語切り替え

### ✅ Phase 6-7: コードアーキテクチャ・品質向上（完了）
#### Phase 6: 完全コードアーキテクチャ整理
- [x] **@Deprecated メソッド除去** - 使用されていない非推奨メソッドの体系的削除
  - [x] コントローラー整理: 8つの未使用@Deprecatedコントローラーメソッド削除
  - [x] サービス整理: 11つの未使用@Deprecatedサービスメソッド削除
  - [x] コードベース縮小: 400+行のレガシーコード除去

#### Phase 7: SQL実行結果メタデータ拡張
- [x] **ColumnDetailレコード実装** - フロントエンド向けリッチSQL結果メタデータ
  - [x] カラム名、型、精度、スケール、null許可情報
  - [x] バックエンド同期付きフロントエンドTypeScript型定義
  - [x] 詳細なカラム情報による拡張結果表示機能

### 🔄 Phase 8+: エンタープライズ機能（オプション）
- [ ] 視覚的リレーションシップマッピング付きの高度なJOIN句ビルダー
- [ ] クエリパフォーマンス最適化提案
- [ ] 高度な結果エクスポート（CSV、JSON、Excel）
- [ ] クエリテンプレートとスニペット管理

### 🚀 Phase 5: エンタープライズ機能（オプション）
- [ ] ユーザーロール管理と権限
- [ ] 監査ログとコンプライアンス機能
- [ ] 高度なパフォーマンス分析ダッシュボード
- [ ] AI駆動のクエリ最適化提案

## 📁 プロジェクト構造

```
sqlapp2/
├── src/main/java/cherry/sqlapp2/           # Spring Bootバックエンド
│   ├── controller/                         # REST APIコントローラー
│   ├── service/                           # ビジネスロジックサービス
│   ├── entity/                            # JPAエンティティ
│   ├── repository/                        # データアクセス層
│   ├── dto/                              # データ転送オブジェクト
│   ├── config/                           # 設定クラス
│   └── security/                         # セキュリティコンポーネント
├── src/main/resources/
│   ├── application.properties            # バックエンド設定
│   └── static/                          # ビルドされたフロントエンドアセット（自動生成）
├── frontend/                            # Reactアプリケーション
│   ├── src/
│   │   ├── components/                  # Reactコンポーネント
│   │   ├── context/                     # Reactコンテキストプロバイダー
│   │   └── utils/                       # ユーティリティ関数
│   ├── package.json                     # フロントエンド依存関係
│   └── vite.config.ts                   # Vite設定
├── build.gradle                         # Gradleビルド設定
├── Dockerfile                           # Dockerイメージ定義
├── docker-compose.yml                   # Docker Compose設定
└── README_ja.md                        # このファイル
```

## 📜 ライセンス

このプロジェクトはApache License 2.0の下でライセンスされています - 詳細は[LICENSE](LICENSE)ファイルを参照してください。

## 🙏 謝辞

- [Spring Boot](https://spring.io/projects/spring-boot) - エンタープライズJavaフレームワーク
- [React](https://reactjs.org/) - UIコンポーネントライブラリ
- [Vite](https://vitejs.dev/) - 高速ビルドツール
- [H2 Database](https://www.h2database.com/) - 組み込みデータベース
- [JWT.io](https://jwt.io/) - JSON Web Tokens

---

**SqlApp2チームによって❤️で作られました**

*SqlApp2 - モダンで安全なSQLツールでデータベースプロフェッショナルを支援*